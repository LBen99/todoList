<%- include("../partials/head"); %>

<%- include("../partials/header"); %>

<div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
  <header class="mb-auto">
    <div>
      <h3 class="float-md-start mb-0"><%= date %></h3>
      <nav class="nav nav-masthead justify-content-center float-md-end">
          <a class="nav-link fw-bold py-1 px-0 active" aria-current="page" href="/todo">Today</a>
          <a class="nav-link fw-bold py-1 px-0" href="/my-lists">Lists</a>
          <a class="nav-link fw-bold py-1 px-0" href="/logout">Logout</a>
      </nav>
    </div>
  </header>

  <main class="px-3">

    <div class="box" id="heading">
      <div class="">
        <div class="previous-btn">
          <form action="/todo/previous" method="post">
            <button type="submit" name="previousList" value="<%= listTitle %>">
              <
            </button>
          </form>
        </div>

        <div class="list-heading">
          <form action="/my-lists" method="post">
            <button class="list-heading-btn" type="submit" name="currentList" value="<%= listTitle %>" onclick="window.location.href='viewCollection.ejs'">
              <h1><%= listTitle %></h1>
            </button>
          </form>
        </div>

        <div class="next-btn">
          <form action="/todo/next" method="post">
            <button type="submit" name="nextList" value="<%= listTitle %>">></button>
          </form>
        </div>
      </div>

      <div class="list-options">
        <button class="add-item-btn" type="button" class="btn" data-bs-toggle="modal" data-bs-target="#addItemModal">
          +
        </button>
        <div class="modal fade" id="addItemModal" tabindex="-1" aria-labelledby="addItemModalLabel" aria-hidden="true">
          <div class="modal-dialog" role="document">
            <div class="modal-content rounded-4 shadow">
              <div class="modal-header">
                <h3 class="fw-bold mb-0">Add new task!</h3>
              </div>
              <form action="/todo" method="post">        
                <div id="modalAddItemForm">
                  <div class="modal-body">
                    <div class="mb-3 px-3">
                      <label for="newItemInput" class="form-label">New Item</label>
                      <input type="text" class="form-control" name="newItem" id="newItemInput" autocomplete="off">
                    </div>
                    <div class="dropdown-center px-3">
                      <button class="btn add-item-modal-dropdown dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <%= listTitle %>
                      </button>
                      <ul class="dropdown-menu">
                        <% allLists.forEach((list) => { %>
                          <li>
                            <a class="dropdown-item" data-value="<%= list._id %>"><%= list.name.replace(/\w/, c => c.toUpperCase()) %></a>
                            <input id="listId" type="hidden" name="listId" value="<%= list._id %>">
                          </li>
                        <% }) %>
                      </ul>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <input id="thisId" type="hidden" name="thisId" value="<%= lists[0]._id %>">
                    <button type="submit" name="list" value="<%= listTitle%>" class="btn btn-lg save-item-button mt-5 w-100" data-bs-dismiss="modal">Save task!</button>
                  </div>           
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>

      <div class="box">

        <% lists.forEach((item) => { %>
          <form action="/todo/deleteItem" method="post">
            <div class="item">
              <input type="checkbox" name="checkbox" value="<%= item.items._id %>" onChange="this.form.submit()">
              <p><%= item.items.name %></p>
            </div>
            <input type="hidden" name="thisList" value="<%= listTitle %>">
          </form>
          <% }) %>
      </div>

  </main>
</div>

<%- include("../partials/footer"); %>
